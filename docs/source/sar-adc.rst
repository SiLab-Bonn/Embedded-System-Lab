========================================
Experiment: Successive Approximation ADC
========================================

.. figure:: images/sar_adc.png
    :width: 300
    :align: center

    SAR ADC Module

In this module, function and performance of a 8-bit successive-approximation register analog-digital-converter (SAR-ADC) will be studied. A SAR-ADC consits mainly of a digital-to-analog converter (DAC), a comparator, and a digital control logic.

.. figure:: images/sar_adc_block.png
    :width: 600
    :align: center

    Functional block diagram of the SAR-ADC

To find the digital equivalent of an analog value, the input voltage is compared to the programmable  output voltage of a DAC. To minimize the number of neccessary comparison cycles, the successive approximation method is used: Instead of lineary increasing (or dereasing) the DAC output voltage and capturing the DAC register value at which the comparator output changes its state (that ADC concept is called "Wilkinson" ADC), a SAR-ADC switches and compares the DAC voltage bit by bit starting from the most significant bit (MSB) down to the least significant bit (LSB). This method allows an n-Bit ADC to convert an analog value within n-cycles. The SAR sequence for a conversion which would be generated by the control logic looks like this (pseudo code):

.. code-block:: c

  1. // start with DAC mid-range voltage: set MSB to '1' by shifting a '1' n-bits to the left
  DAC_register = 1 << n          
  
  2. // Repeat code block below n-times while j runs from n-1 to 0.
  if (VDAC < VIN)            // compare ADC input with DAC output (i.e. read the result of the comparator)
    DAC_register -= (1 << j) // DAC output larger then VIN, subtract next LSB value from current DAC setting
  else
    DAC_register += (1 << j) // DAC output smaller then VIN, add next LSB value to current DAC setting
 
  3. // The final DAC register value after n-iterations is the digital representation of the analog input voltage.
  result = DAC_register
  
Digital to Analog Converter
---------------------------
The digital-to-analog converter is implemented with a resistive voltage divider connected to a reference voltage VREF which allows the output voltage to be programmed in the range [0 .. VREF] with a step size of VREF/2^n. A resistive voltage divider for an n-bit DAC can be constructed from 2^n equal sized resistors and 2^n switches (also called a resistor string divider or thermometer encoded ladder) or a binary weighted ladder. The latter one would require only n+1 resistors with values from R to 2^n x R. However, the required matching of resistor values over that value range is typically not easy to achieve. A clever re-arrangement of resistor and switches using 2xn resistors and n switches allows the usage of resistors with the value R and 2xR only. This so-called R-2R ladder is used for the module's DAC.
 
 .. figure:: images/sar_adc_r2r_dac.png
    :width: 600
    :align: center

    Resitive ladder (R-2R) digital analog converter
    
The R-2R DAC uses an 8-bit digital buffer which power supply is connected to VREF, to switch the resistive ladder taps to either 0 or VREF. The voltage at the output of the ladder is the binary weighted sum of the bits whose output is set to VREF.
 
Circuit Implementation 
----------------------



ADC Performance Parameters
-------------------------
- Noise
- Linearity
- INL/DNL


Exercises 
---------
